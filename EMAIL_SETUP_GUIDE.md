# מדריך הגדרת מערכת המייל

## סקירה כללית

המערכת כוללת שליחת מיילים מעוצבים אוטומטית למשתמשים חדשים שנוצרים דרך ממשק ניהול המשתמשים. המייל כולל:

- ברכה אישית למשתמש החדש
- פרטי ההתחברות
- קישור ישיר לאתר
- הוראות התחלה
- עיצוב מותאם לעברית (RTL)

## הגדרת משתני הסביבה

הוסף את המשתנים הבאים לקובץ `.env.local`:

```env
# Email Configuration
EMAIL_HOST=smtp.gmail.com
EMAIL_PORT=587
EMAIL_USER=your-email@gmail.com
EMAIL_PASS=your-app-password

# כתובת האתר לקישורים במייל
NEXT_PUBLIC_SITE_URL=http://localhost:3000
```

### הגדרת Gmail

1. **הפעלת אימות דו-שלבי**: נדרש להפעיל אימות דו-שלבי בחשבון Gmail
2. **יצירת סיסמת אפליקציה**:
   - עבור להגדרות החשבון של Google
   - בחר "אבטחה" > "אימות דו-שלבי" > "סיסמאות אפליקציות"
   - צור סיסמת אפליקציה חדשה
   - השתמש בסיסמה זו במשתנה `EMAIL_PASS`

### הגדרת ספקי מייל אחרים

#### Outlook/Hotmail
```env
EMAIL_HOST=smtp-mail.outlook.com
EMAIL_PORT=587
EMAIL_USER=your-email@outlook.com
EMAIL_PASS=your-password
```

#### Yahoo
```env
EMAIL_HOST=smtp.mail.yahoo.com
EMAIL_PORT=587
EMAIL_USER=your-email@yahoo.com
EMAIL_PASS=your-app-password
```

#### ספק מייל מותאם אישית
```env
EMAIL_HOST=mail.your-domain.com
EMAIL_PORT=587  # או 465 עבור SSL
EMAIL_USER=your-email@your-domain.com
EMAIL_PASS=your-password
```

## תכונות המערכת

### שליחה אוטומטית
- מייל נשלח אוטומטית לכל משתמש חדש שנוצר דרך "יצירה ישירה"
- כולל גם ייבוא משתמשים בכמות דרך CSV במצב "יצירה ישירה"
- המערכת לא תכשיל את יצירת המשתמש אם המייל לא נשלח
- סטטוס שליחת המייל מוצג בממשק

### בדיקת המערכת
- כפתור "בדיקת מייל" בממשק ניהול המשתמשים
- בדיקת חיבור לשרת המייל
- שליחת מייל בדיקה לכתובת שתבחר

### עיצוב המייל
- תמיכה מלאה בעברית (RTL)
- עיצוב רספונסיבי
- צבעים ואייקונים מותאמים
- תוכן מובנה וברור

## שימוש במערכת

### יצירת משתמש חדש
1. עבור לממשק ניהול המשתמשים
2. לחץ על "הוספת משתמש חדש"
3. בחר "יצירה ישירה" (אם זמין)
4. מלא את הפרטים הנדרשים
5. המייל יישלח אוטומטית לאחר יצירת המשתמש

### ייבוא משתמשים בכמות
1. עבור לממשק ניהול המשתמשים
2. לחץ על "ייבוא משתמשים מ-CSV"
3. בחר "יצירה ישירה" (אם זמין)
4. הורד את תבנית ה-CSV והכן את הקובץ
5. העלה את הקובץ ובצע את הייבוא
6. מיילים יישלחו אוטומטית לכל המשתמשים שנוצרו בהצלחה
7. תוצג סטטיסטיקה על כמות המיילים שנשלחו/נכשלו

### בדיקת המערכת
1. עבור לממשק ניהול המשתמשים
2. לחץ על "בדיקת מייל"
3. בחר "בדיקת חיבור" לוודא שהחיבור לשרת המייל תקין
4. הזן כתובת מייל ולחץ "שליחת מייל בדיקה"

## פתרון בעיות

### המייל לא נשלח
1. **בדוק את משתני הסביבה**: ודא שכל המשתנים מוגדרים נכון
2. **בדוק את פרטי ההתחברות**: ודא שהמייל והסיסמה נכונים
3. **בדוק את הגדרות האבטחה**: ודא שסיסמת אפליקציה מוגדרת (Gmail)
4. **בדוק את הלוגים**: עיין בלוגים של השרת לפרטים נוספים

### שגיאות נפוצות
- **"Authentication failed"**: בדוק את פרטי ההתחברות
- **"Connection timeout"**: בדוק את כתובת השרת והפורט
- **"Invalid recipients"**: בדוק את כתובת המייל של הנמען

### בדיקת הגדרות
```bash
# הרץ את הפקודה הבאה לבדיקת משתני הסביבה
node -e "console.log({
  host: process.env.EMAIL_HOST,
  port: process.env.EMAIL_PORT,
  user: process.env.EMAIL_USER,
  hasPass: !!process.env.EMAIL_PASS
})"
```

## אבטחה

- **אל תשתף את סיסמאות האפליקציה**: שמור אותן בסוד
- **השתמש בסיסמאות אפליקציה**: אל תשתמש בסיסמת החשבון הרגילה
- **עדכן סיסמאות באופן קבוע**: החלף סיסמאות אפליקציה מעת לעת
- **הגבל הרשאות**: השתמש בחשבון מייל ייעודי למערכת

## התאמה אישית

### שינוי תוכן המייל
ערוך את הקובץ `lib/services/emailService.ts` ואת הפונקציה `generateWelcomeEmailHTML`

### שינוי עיצוב המייל
עדכן את ה-CSS בתוך הפונקציה `generateWelcomeEmailHTML`

### הוספת שדות נוספים
הוסף שדות לממשק `WelcomeEmailData` ועדכן את הקריאות לפונקציה

## תמיכה

אם נתקלת בבעיות:
1. בדוק את הלוגים של השרת
2. השתמש בכלי בדיקת המייל המובנה
3. ודא שהגדרות הספק שלך נכונות
4. בדוק את חיבור האינטרנט והפיירוול