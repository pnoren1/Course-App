# מדריך התחברות עם שם משתמש וסיסמה

## סקירה כללית

המערכת כעת תומכת בשתי דרכי התחברות:
1. **התחברות עם Google** - האפשרות הקיימת
2. **התחברות עם שם משתמש וסיסמה** - האפשרות החדשה

## איך זה עובד

### עבור משתמשים
1. בדף ההתחברות (`/login`) יש כעת שני טאבים:
   - **שם משתמש וסיסמה** - ברירת המחדל החדשה
   - **Google** - האפשרות הקיימת

2. משתמשים יכולים להתחבר עם:
   - כתובת אימייל וסיסמה שהוגדרו עבורם על ידי מנהל המערכת

### עבור מנהלי המערכת
1. בממשק המנהל (`/admin`) ניתן ליצור משתמשים חדשים בשתי דרכים:
   - **יצירה ישירה** - יוצר משתמש עם סיסמה מיד
   - **שליחת הזמנה** - שולח הזמנה למשתמש להרשמה

2. ליצירה ישירה נדרש:
   - כתובת אימייל
   - שם משתמש (אופציונלי)
   - סיסמה (לפחות 6 תווים)
   - תפקיד (סטודנט/מרצה/מנחה/מנהל)
   - ארגון (אופציונלי)

## דרישות טכניות

### עבור יצירה ישירה של משתמשים
- נדרש `SUPABASE_SERVICE_ROLE_KEY` בקובץ `.env.local`
- המשתמש שיוצר חייב להיות בעל תפקיד מנהל

### אבטחה
- הסיסמאות מוצפנות אוטומטית על ידי Supabase
- האימייל מאומת אוטומטית עבור משתמשים שנוצרו ישירות
- בדיקת הרשאות מתבצעת בכל פעולה

## הודעות שגיאה נפוצות

### בהתחברות
- **"שם משתמש או סיסמה שגויים"** - פרטי ההתחברות שגויים
- **"החשבון שלך לא מורשה לגשת למערכת"** - המשתמש לא קיים בטבלת `user_profile`

### ביצירת משתמשים
- **"משתמש עם כתובת מייל זו כבר קיים"** - האימייל כבר רשום במערכת
- **"יצירה ישירה לא זמינה"** - חסר Service Role Key או הרשאות מנהל

## מבנה הנתונים

המערכת משתמשת בשתי טבלאות עיקריות:
1. `auth.users` - טבלת המשתמשים של Supabase (מנוהלת אוטומטית)
2. `user_profile` - פרופילי המשתמשים עם תפקידים וארגונים

## שינויים שבוצעו

### קבצים חדשים
- `app/login/components/UsernamePasswordSignIn.tsx` - קומפוננט התחברות עם סיסמה

### קבצים שעודכנו
- `app/login/page.tsx` - הוספת טאבים לבחירת דרך התחברות

### קבצים קיימים שכבר תמכו בפונקציונליות
- `app/api/admin/create-user/route.ts` - כבר תמך ביצירת משתמשים עם סיסמה
- `app/components/AddUserForm.tsx` - כבר תמך בממשק ליצירת משתמשים עם סיסמה

## בדיקות מומלצות

1. **התחברות עם סיסמה**:
   - יצירת משתמש חדש עם סיסמה
   - התחברות עם המשתמש החדש
   - בדיקת הפניה לדף הקורס

2. **התחברות עם Google**:
   - וידוא שהאפשרות הקיימת עדיין עובדת

3. **אבטחה**:
   - ניסיון התחברות עם פרטים שגויים
   - ניסיון גישה למשתמש לא מורשה