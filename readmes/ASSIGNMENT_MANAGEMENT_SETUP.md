# מדריך הגדרת מערכת ניהול מטלות

## הפעלת המיגרציה

כדי להפעיל את מערכת ניהול המטלות, יש להריץ את המיגרציה החדשה:

```bash
# אם אתה משתמש ב-Supabase CLI
supabase db push

# או אם אתה מריץ ידנית
psql -h [your-host] -U [your-user] -d [your-database] -f supabase/migrations/028_create_assignments_table.sql
```

## מבנה הטבלאות החדשות

### assignments
- `id` - מזהה ייחודי של המטלה
- `title` - כותרת המטלה
- `description` - תיאור המטלה (אופציונלי)
- `unit_id` - מזהה היחידה שאליה שייכת המטלה
- `due_date` - תאריך יעד להגשה (אופציונלי)
- `max_file_size_mb` - גודל קובץ מקסימלי במגה-בייט
- `allowed_file_types` - סוגי קבצים מותרים (מערך)
- `estimated_duration_minutes` - זמן משוער לביצוע המטלה בדקות
- `required_files` - רשימת קבצים נדרשים (JSON)
- `created_at`, `updated_at` - חותמות זמן

### assignment_submissions
- `id` - מזהה ייחודי של ההגשה
- `assignment_id` - מזהה המטלה
- `user_id` - מזהה המשתמש
- `submission_date` - תאריך ההגשה
- `status` - סטטוס ההגשה
- `created_at`, `updated_at` - חותמות זמן

### submission_files
- `id` - מזהה ייחודי של הקובץ
- `submission_id` - מזהה ההגשה
- `original_filename` - שם הקובץ המקורי
- `storage_path` - נתיב האחסון
- `file_size_bytes` - גודל הקובץ בבייטים
- `file_type` - סוג הקובץ
- `uploaded_at` - זמן העלאה

## הרשאות (RLS)

המערכת כוללת מדיניות RLS מלאה:
- משתמשים רגילים יכולים לצפות במטלות ולהגיש הגשות
- מנהלים יכולים לנהל מטלות ולצפות בכל ההגשות
- משתמשים יכולים לצפות רק בהגשות שלהם

## גישה למערכת

### למנהלים
1. היכנס לפאנל הניהול: `/admin`
2. לחץ על "ניהול מטלות"
3. או גש ישירות ל: `/admin/assignments`

### תכונות המערכת
- יצירת מטלות חדשות
- עריכת מטלות קיימות
- מחיקת מטלות (רק אם אין הגשות)
- הגדרת קבצים נדרשים
- הגדרת סוגי קבצים מותרים
- הגדרת גודל קובץ מקסימלי
- הגדרת תאריך יעד

## API Endpoints

### GET /api/admin/assignments
קבלת כל המטלות (מנהלים בלבד)

### POST /api/admin/assignments
יצירת מטלה חדשה (מנהלים בלבד)

### PUT /api/admin/assignments/[id]
עדכון מטלה קיימת (מנהלים בלבד)

### DELETE /api/admin/assignments/[id]
מחיקת מטלה (מנהלים בלבד, רק אם אין הגשות)

## הערות חשובות

1. **מחיקת מטלות**: לא ניתן למחוק מטלה שיש לה הגשות קיימות
2. **קבצים נדרשים**: ניתן להגדיר רשימת קבצים ספציפיים שהמשתמש צריך להגיש
3. **סוגי קבצים**: המערכת תומכת בסינון לפי סוגי קבצים
4. **גודל קבצים**: ניתן להגדיר גודל מקסימלי לכל קובץ

## פתרון בעיות

### שגיאת הרשאות
ודא שהמשתמש הוא מנהל במערכת

### שגיאת מסד נתונים
ודא שהמיגרציה רצה בהצלחה ושהטבלאות נוצרו

### בעיות בטעינת יחידות
ודא שקובץ `lessons.json` נגיש ותקין