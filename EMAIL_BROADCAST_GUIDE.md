# מדריך שליחת מיילים למשתמשים

## סקירה כללית
מערכת שליחת מיילים המאפשרת למנהלי מערכת לשלוח הודעות למשתמשים במערכת.

## תכונות
- שליחה לכל המשתמשים במערכת
- שליחה לארגון ספציפי
- שליחה לקבוצה ספציפית
- שליחה למשתמש בודד
- שליחה בעותק מוסתר (BCC) לכל הנמענים
- תצוגה מקדימה של המייל לפני השליחה
- ספירת נמענים בזמן אמת
- עיצוב זהה למיילים הקיימים במערכת

## גישה למערכת
הגישה למערכת זמינה רק למנהלי מערכת (admin) דרך:
- תפריט הניהול: `/admin/send-email`
- או דרך הניווט: "שליחת מיילים"

## שימוש במערכת

### 1. בחירת נמענים
בחר את סוג הנמענים:
- **כל המשתמשים** - שליחה לכל המשתמשים במערכת
- **ארגון ספציפי** - בחר ארגון מהרשימה
- **קבוצה ספציפית** - בחר ארגון ולאחר מכן קבוצה
- **משתמש בודד** - בחר משתמש ספציפי מהרשימה

### 2. כתיבת המייל
- **נושא** - הזן את נושא המייל
- **תוכן ההודעה** - כתוב את תוכן המייל (תומך בשורות מרובות)

### 3. תצוגה מקדימה
לחץ על "תצוגה מקדימה" כדי לראות איך המייל ייראה לנמענים.
התצוגה המקדימה כוללת:
- עיצוב המייל המלא
- מספר הנמענים שיקבלו את המייל
- אפשרות לשלוח ישירות מהתצוגה המקדימה

### 4. שליחת המייל
לחץ על "שלח מייל" או "אישור ושליחה" מהתצוגה המקדימה.
המערכת תציג הודעת הצלחה עם מספר הנמענים שקיבלו את המייל.

## מבנה טכני

### קבצים שנוצרו
1. **עמוד הממשק** - `app/admin/send-email/page.tsx`
2. **API שליחת מייל** - `app/api/admin/send-email/route.ts`
3. **API ספירת נמענים** - `app/api/admin/recipient-count/route.ts`
4. **API ארגונים** - `app/api/admin/organizations/route.ts`
5. **API משתמשים** - `app/api/admin/users/route.ts`
6. **שירות מייל מעודכן** - `lib/services/emailService.ts` (נוספה פונקציה `sendBulkEmail`)

### עיצוב המייל
המיילים נשלחים עם אותו עיצוב כמו מיילי הרישום:
- כותרת עם לוגו פורטל הקורסים
- תוכן ההודעה במרכז
- כותרת תחתונה עם הערה שהמייל נשלח אוטומטית

### אבטחה
- גישה מוגבלת למנהלי מערכת בלבד
- אימות הרשאות בכל API endpoint
- שליחה בעותק מוסתר (BCC) לשמירה על פרטיות הנמענים

## הערות חשובות
- המיילים נשלחים מאותה כתובת שולח כמו מיילי המערכת
- השליחה היא בעותק מוסתר (BCC) - הנמענים לא רואים את כתובות המייל של נמענים אחרים
- המערכת מציגה את מספר הנמענים לפני השליחה
- ניתן לכתוב הודעות עם שורות מרובות
- המערכת מונעת שליחה אם אין נמענים או אם השדות ריקים
