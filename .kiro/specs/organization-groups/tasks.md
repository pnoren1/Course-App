# תוכנית יישום: שיוך קבוצות בתוך ארגונים

## סקירה כללית

היישום יתבצע בשלבים הדרגתיים, החל משינויי מסד הנתונים, דרך API ושירותים, ועד לרכיבי ממשק המשתמש. כל שלב יבנה על הקודם ויכלול בדיקות מתאימות.

## משימות

- [x] 1. הגדרת מבנה מסד נתונים וביטחון
  - יצירת טבלת groups עם constraints מתאימים
  - עדכון טבלת user_profile עם קשר לקבוצות
  - הגדרת RLS policies לבקרת גישה
  - יצירת אינדקסים לביצועים
  - _Requirements: 1.2, 1.4, 4.1, 4.2, 4.3, 4.4_

- [ ]* 1.1 כתיבת בדיקת property עבור constraints מסד נתונים
  - **Property 3: מחיקת קבוצה עם משתמשים נכשלת**
  - **Validates: Requirements 1.4, 2.5**

- [x] 2. יישום שירותי ליבה (Core Services)
  - [x] 2.1 יישום GroupService עם כל פונקציות CRUD
    - יצירת interface GroupService
    - יישום createGroup, updateGroup, deleteGroup, getGroupById
    - יישום getGroupsByOrganization, validateGroupDeletion
    - _Requirements: 1.2, 1.3, 1.4, 1.5_

  - [ ]* 2.2 כתיבת בדיקות property עבור GroupService
    - **Property 1: יצירת קבוצה דורשת נתונים חובה**
    - **Property 2: עדכון קבוצה לא משנה ארגון**
    - **Property 4: רשימת קבוצות מכילה נתונים נדרשים**
    - **Validates: Requirements 1.2, 1.3, 1.5**

  - [x] 2.3 עדכון UserService לתמיכה בקבוצות
    - הוספת groupId לפונקציות יצירה ועדכון
    - יישום updateUserGroup, getUsersByGroup
    - יישום validateUserGroupAssignment
    - _Requirements: 2.1, 2.3, 2.4_

  - [ ]* 2.4 כתיבת בדיקות property עבור UserService מעודכן
    - **Property 6: עדכון קבוצת משתמש מוגבל לאותו ארגון**
    - **Property 7: העברת ארגון מחייבת קבוצה חדשה**
    - **Validates: Requirements 2.3, 2.4**

- [x] 3. פיתוח API endpoints
  - [x] 3.1 יישום /api/admin/groups endpoints
    - GET, POST עבור רשימה ויצירה
    - הוספת validation ו-error handling
    - _Requirements: 1.2, 1.5, 6.2_

  - [x] 3.2 יישום /api/admin/groups/[id] endpoints
    - GET, PUT, DELETE עבור קבוצה ספציפית
    - בדיקת הרשאות לפני כל פעולה
    - _Requirements: 1.3, 1.4, 4.1, 4.2, 4.3_

  - [x] 3.3 יישום /api/admin/groups/by-organization/[orgId]
    - החזרת קבוצות מסוננות לפי ארגון
    - _Requirements: 2.2_

  - [ ]* 3.4 כתיבת בדיקות property עבור API endpoints
    - **Property 5: סינון קבוצות לפי ארגון**
    - **Property 11: בקרת גישה לפי הרשאות**
    - **Property 12: הודעות שגיאה בעברית**
    - **Validates: Requirements 2.2, 4.1-4.4, 6.2**

- [ ] 4. Checkpoint - וידוא שכל הבדיקות עוברות
  - וידוא שכל הבדיקות עוברות, שאל את המשתמש אם יש שאלות.

- [x] 5. פיתוח רכיבי UI בסיסיים
  - [x] 5.1 יישום GroupSelector component
    - Dropdown עם קבוצות לפי ארגון נבחר
    - טעינה דינמית כשהארגון משתנה
    - _Requirements: 2.2_

  - [x] 5.2 יישום UserGroupDisplay component
    - תצוגת ארגון וקבוצה של משתמש
    - טיפול במקרים של משתמש ללא קבוצה
    - _Requirements: 3.1, 3.3_

  - [ ]* 5.3 כתיבת בדיקות property עבור UI components
    - **Property 8: תצוגת פרופיל כוללת מידע קבוצה**
    - **Property 9: טיפול במשתמשים ללא קבוצה**
    - **Validates: Requirements 3.1, 3.3, 5.2**

- [x] 6. פיתוח ממשק ניהול קבוצות
  - [x] 6.1 יישום GroupManagement component
    - רשימת קבוצות עם אפשרויות עריכה ומחיקה
    - טופס יצירת קבוצה חדשה
    - סינון וחיפוש קבוצות
    - _Requirements: 1.1, 1.2, 1.3, 1.4, 1.5_

  - [x] 6.2 אינטגרציה עם ממשק הניהול הקיים
    - הוספת קישור לניהול קבוצות בתפריט הניהול
    - וידוא תאימות עם עיצוב קיים
    - _Requirements: 1.1_

  - [ ]* 6.3 כתיבת בדיקות property עבור ממשק ניהול
    - **Property 13: הודעות הצלחה ועדכון תצוגה**
    - **Validates: Requirements 6.3**

- [x] 7. עדכון מסכי יצירת ועריכת משתמשים
  - [x] 7.1 עדכון AddUserForm component
    - הוספת GroupSelector לטופס
    - עדכון validation לדרוש בחירת קבוצה
    - _Requirements: 2.1_

  - [x] 7.2 עדכון מסכי עריכת משתמש קיים
    - הוספת אפשרות לשנות קבוצה (באותו ארגון)
    - הוספת אפשרות להעביר לארגון אחר עם בחירת קבוצה
    - _Requirements: 2.3, 2.4_

  - [ ]* 7.3 כתיבת בדיקות יחידה עבור טפסי משתמש
    - בדיקת validation של שדות חובה
    - בדיקת התנהגות כשארגון משתנה
    - _Requirements: 2.1, 2.3, 2.4_

- [x] 8. עדכון תצוגת פרופיל משתמש
  - [x] 8.1 עדכון רכיב פרופיל משתמש
    - הוספת תצוגת קבוצה לפרופיל
    - שימוש ב-UserGroupDisplay component
    - _Requirements: 3.1, 3.3_

  - [x] 8.2 עדכון רכיבי תצוגת משתמש במקומות אחרים
    - עדכון רשימות משתמשים להציג קבוצה
    - עדכון UserRoleBadge אם נדרש
    - _Requirements: 3.1_

  - [ ]* 8.3 כתיבת בדיקות property עבור תצוגת פרופיל
    - **Property 10: עדכון נתונים מעדכן תצוגה**
    - **Validates: Requirements 3.4**

- [x] 9. אינטגרציה ובדיקות מערכת
  - [x] 9.1 חיבור כל הרכיבים יחד
    - וידוא שכל הרכיבים עובדים יחד
    - בדיקת זרימות עבודה מלאות
    - _Requirements: כל הדרישות_

  - [x] 9.2 בדיקת תאימות לאחור
    - וידוא שמשתמשים קיימים ללא קבוצה עובדים
    - בדיקת API endpoints קיימים
    - _Requirements: 5.1, 5.2, 5.3, 5.4_

  - [ ]* 9.3 כתיבת בדיקות אינטגרציה
    - בדיקת זרימות עבודה מלאות
    - בדיקת תרחישי שגיאה
    - _Requirements: כל הדרישות_

- [ ] 10. Checkpoint סופי - וידוא שכל הבדיקות עוברות
  - וידוא שכל הבדיקות עוברות, שאל את המשתמש אם יש שאלות.

## הערות

- משימות המסומנות ב-`*` הן אופציונליות וניתן לדלג עליהן עבור MVP מהיר יותר
- כל משימה מתייחסת לדרישות ספציפיות לצורך מעקב
- נקודות ביקורת מבטיחות אימות הדרגתי
- בדיקות property מאמתות מאפייני נכונות אוניברסליים
- בדיקות יחידה מאמתות דוגמאות ספציפיות ומקרי קצה