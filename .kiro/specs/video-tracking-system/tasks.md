# מערכת מעקב צפייה בסרטונים - רשימת משימות

## Phase 1: מבנה מסד נתונים ו-API בסיסי

### 1. הכנת מסד הנתונים
- [ ] 1.1 יצירת migration למבנה הטבלאות הבסיסי
  - [ ] 1.1.1 יצירת טבלת `video_lessons`
  - [ ] 1.1.2 יצירת טבלת `video_viewing_sessions`
  - [ ] 1.1.3 יצירת טבלת `video_viewing_events`
  - [ ] 1.1.4 יצירת טבלת `video_progress`
- [ ] 1.2 הגדרת RLS policies לטבלאות החדשות
- [ ] 1.3 יצירת indexes לביצועים מיטביים
- [ ] 1.4 הוספת triggers לעדכון אוטומטי של timestamps

### 2. פיתוח API endpoints בסיסיים
- [ ] 2.1 יצירת `/api/video/lessons` - ניהול סרטוני הקורס
  - [ ] 2.1.1 GET - קבלת רשימת סרטונים
  - [ ] 2.1.2 POST - הוספת סרטון חדש (admin only)
  - [ ] 2.1.3 PUT - עדכון פרטי סרטון (admin only)
  - [ ] 2.1.4 DELETE - מחיקת סרטון (admin only)
- [ ] 2.2 יצירת `/api/video/sessions` - ניהול sessions צפייה
  - [ ] 2.2.1 POST - יצירת session חדש
  - [ ] 2.2.2 PUT - עדכון session קיים
  - [ ] 2.2.3 DELETE - סגירת session
- [ ] 2.3 יצירת `/api/video/events` - מעקב אירועי צפייה
  - [ ] 2.3.1 POST - שליחת אירוע צפייה
  - [ ] 2.3.2 POST batch - שליחת מספר אירועים יחד
- [ ] 2.4 יצירת `/api/video/progress` - נתוני התקדמות
  - [ ] 2.4.1 GET - קבלת התקדמות משתמש
  - [ ] 2.4.2 GET admin - קבלת התקדמות כל המשתמשים

### 3. פיתוח שירותי Backend
- [ ] 3.1 יצירת `VideoTrackingService` - שירות מעקב צפייה
  - [ ] 3.1.1 פונקציית יצירת session
  - [ ] 3.1.2 פונקציית עיבוד אירועי צפייה
  - [ ] 3.1.3 פונקציית חישוב התקדמות
- [ ] 3.2 יצירת `VideoProgressCalculator` - חישוב התקדמות מדויק
  - [ ] 3.2.1 אלגוריתם מיזוג segments צפייה
  - [ ] 3.2.2 חישוב אחוז השלמה
  - [ ] 3.2.3 זיהוי פעילות חשודה
- [ ] 3.3 יצירת `VideoSecurityService` - הגנה מפני רמאות
  - [ ] 3.3.1 בדיקת sessions מקבילים
  - [ ] 3.3.2 אימות נתוני אירועים
  - [ ] 3.3.3 זיהוי דפוסי רמאות

## Phase 2: רכיב צפייה עם מעקב בסיסי

### 4. פיתוח רכיב VideoPlayer
- [ ] 4.1 יצירת רכיב `VideoPlayer` בסיסי
  - [ ] 4.1.1 אינטגרציה עם Spotlightr
  - [ ] 4.1.2 מעקב אירועי play/pause
  - [ ] 4.1.3 מעקב אירועי seek
  - [ ] 4.1.4 מעקב heartbeat תקופתי
- [ ] 4.2 הוספת מעקב מצב הדפדפן
  - [ ] 4.2.1 שימוש ב-Page Visibility API
  - [ ] 4.2.2 מעקב focus/blur של החלון
  - [ ] 4.2.3 זיהוי שינוי טאבים
- [ ] 4.3 יצירת hook `useVideoTracking`
  - [ ] 4.3.1 ניהול session state
  - [ ] 4.3.2 שליחת אירועים לשרת
  - [ ] 4.3.3 טיפול בשגיאות רשת

### 5. פיתוח רכיב VideoProgress
- [ ] 5.1 יצירת רכיב `VideoProgress` להצגת התקדמות
  - [ ] 5.1.1 תצוגת אחוז השלמה
  - [ ] 5.1.2 תצוגת זמן צפייה כולל
  - [ ] 5.1.3 אינדיקטור השלמה
- [ ] 5.2 הוספת עדכון בזמן אמת
  - [ ] 5.2.1 polling תקופתי לעדכון נתונים
  - [ ] 5.2.2 אופטימיזציה עם caching
- [ ] 5.3 הוספת תצוגת פרטים מורחבת
  - [ ] 5.3.1 היסטוריית צפייה
  - [ ] 5.3.2 זמני צפייה לפי תאריכים

## Phase 3: מנגנוני הגנה מפני רמאות

### 6. מימוש זיהוי רמאות
- [x] 6.1 פיתוח מנגנון זיהוי צפייה מקבילה
  - [x] 6.1.1 בדיקת sessions פעילים
  - [x] 6.1.2 ביטול sessions ישנים
  - [x] 6.1.3 התראה על ניסיון צפייה מקבילה
- [x] 6.2 ~~פיתוח מנגנון אימות מהירות צפייה~~ (בוטל - לא להגביל מהירות)
  - [x] 6.2.1 מעקב playback rate לצורכי ניתוח בלבד
  - [x] 6.2.2 ~~הגבלת מהירות מקסימלית~~ (בוטל)
  - [x] 6.2.3 ~~סימון צפייה מהירה מדי~~ (בוטל)
- [x] 6.3 פיתוח מנגנון זיהוי דילוגים חשודים
  - [x] 6.3.1 ניתוח דפוסי seek
  - [x] 6.3.2 זיהוי דילוגים גדולים
  - [x] 6.3.3 חישוב ציון חשדנות

### 7. מימוש אימות נתונים
- [x] 7.1 פיתוח אימות timestamps
  - [x] 7.1.1 השוואת client vs server time
  - [x] 7.1.2 זיהוי סטיות זמן חשודות
  - [x] 7.1.3 תיקון אוטומטי של סטיות קטנות
- [x] 7.2 פיתוח אימות רצף אירועים
  - [x] 7.2.1 בדיקת לוגיקה של רצף אירועים
  - [x] 7.2.2 זיהוי אירועים לא תקינים
  - [x] 7.2.3 דחיית נתונים פגומים
- [x] 7.3 פיתוח מנגנון דירוג אמינות
  - [x] 7.3.1 חישוב ציון אמינות לכל session
  - [x] 7.3.2 שקלול נתונים לפי אמינות
  - [x] 7.3.3 סימון משתמשים חשודים

## Phase 4: ממשק ניהול למדריכים

### 8. פיתוח דשבורד אדמין (admin ו-org_admin בלבד)
- [ ] 8.1 יצירת רכיב `AdminVideoAnalytics`
  - [ ] 8.1.1 תצוגת סטטיסטיקות כלליות
  - [ ] 8.1.2 רשימת סטודנטים והתקדמותם
  - [ ] 8.1.3 פילטרים וחיפוש
- [ ] 8.2 יצירת רכיב `StudentVideoProgress`
  - [ ] 8.2.1 פירוט התקדמות לכל סטודנט
  - [ ] 8.2.2 היסטוריית צפייה מפורטת
  - [ ] 8.2.3 זיהוי פעילות חשודה
- [ ] 8.3 יצירת רכיב `VideoSuspiciousActivity`
  - [ ] 8.3.1 רשימת פעילויות חשודות
  - [ ] 8.3.2 פרטי החשד לכל מקרה
  - [ ] 8.3.3 אפשרות לאישור/דחיית חשד

### 9. פיתוח דוחות ויצוא נתונים
- [ ] 9.1 יצירת דוח התקדמות כללי
  - [ ] 9.1.1 סטטיסטיקות צפייה לכל סרטון
  - [ ] 9.1.2 התפלגות ציונים
  - [ ] 9.1.3 זיהוי סרטונים בעייתיים
- [ ] 9.2 יצירת דוח פעילות חשודה
  - [ ] 9.2.1 סיכום מקרי חשד
  - [ ] 9.2.2 ניתוח דפוסים
  - [ ] 9.2.3 המלצות לפעולה
- [ ] 9.3 הוספת יצוא נתונים
  - [ ] 9.3.1 יצוא CSV של נתוני התקדמות
  - [ ] 9.3.2 יצוא JSON של נתונים מפורטים
  - [ ] 9.3.3 יצוא PDF של דוחות

## Phase 5: אינטגרציה עם מערכת הציונים

### 10. פיתוח חישוב ציונים
- [ ] 10.1 יצירת `VideoGradingService`
  - [ ] 10.1.1 חישוב ציון בסיסי לפי אחוז צפייה
  - [ ] 10.1.2 הפחתת ציון עבור פעילות חשודה
  - [ ] 10.1.3 בונוס עבור צפייה מלאה ורציפה
- [ ] 10.2 הוספת הגדרות ציון לכל סרטון
  - [ ] 10.2.1 משקל הסרטון בציון הכולל
  - [ ] 10.2.2 אחוז צפייה מינימלי נדרש
  - [ ] 10.2.3 עונש על פעילות חשודה
- [ ] 10.3 אינטגרציה עם מערכת הציונים הקיימת
  - [ ] 10.3.1 עדכון אוטומטי של ציוני צפייה
  - [ ] 10.3.2 הצגת ציון צפייה בדשבורד
  - [ ] 10.3.3 כלול ציון צפייה בציון הסופי

### 11. פיתוח התראות ומעקב
- [ ] 11.1 יצירת מערכת התראות
  - [ ] 11.1.1 התראה על פעילות חשודה
  - [ ] 11.1.2 התראה על אי השלמת צפייה
  - [ ] 11.1.3 דוח יומי למדריכים
- [ ] 11.2 הוספת הגדרות התראות
  - [ ] 11.2.1 סף חשדנות להתראה
  - [ ] 11.2.2 תדירות דוחות
  - [ ] 11.2.3 רשימת נמענים
- [ ] 11.3 יצירת לוח בקרה למעקב
  - [ ] 11.3.1 מדדי ביצועים בזמן אמת
  - [ ] 11.3.2 גרפים וחזותיים
  - [ ] 11.3.3 התראות פעילות (זמין ל-admin ו-org_admin בלבד)

## Phase 6: אופטימיזציה וביצועים

### 12. אופטימיזציה של ביצועים
- [ ] 12.1 אופטימיזציה של שליחת אירועים
  - [ ] 12.1.1 batching של אירועים
  - [ ] 12.1.2 compression של נתונים
  - [ ] 12.1.3 retry logic לשגיאות רשת
- [ ] 12.2 אופטימיזציה של מסד הנתונים
  - [ ] 12.2.1 partitioning של טבלת אירועים
  - [ ] 12.2.2 archiving של נתונים ישנים
  - [ ] 12.2.3 אופטימיזציה של queries
- [ ] 12.3 הוספת caching
  - [ ] 12.3.1 cache של נתוני התקדמות
  - [ ] 12.3.2 cache של נתוני סרטונים
  - [ ] 12.3.3 invalidation אוטומטי


### 14. תיעוד ופריסה
- [ ] 14.1 כתיבת תיעוד טכני
  - [ ] 14.1.1 תיעוד API
  - [ ] 14.1.2 תיעוד הגדרות מערכת
  - [ ] 14.1.3 מדריך פתרון בעיות
- [ ] 14.2 הכנה לפריסה
  - [ ] 14.2.1 הגדרות environment variables
  - [ ] 14.2.2 scripts לפריסה
  - [ ] 14.2.3 monitoring ו-logging
- [ ] 14.3 הדרכת משתמשים
  - [ ] 14.3.1 מדריך ל-admins ו-org_admins
  - [ ] 14.3.2 מדריך לסטודנטים
  - [ ] 14.3.3 FAQ ופתרון בעיות נפוצות

## משימות נוספות (אופציונליות)

### 15. תכונות מתקדמות
- [ ] 15.1* הוספת תמיכה בסרטונים אינטראקטיביים
  - [ ] 15.1.1* מעקב אחר תשובות לשאלות
  - [ ] 15.1.2* ציון על בסיס אינטראקציה
- [ ] 15.2* אנליטיקה מתקדמת
  - [ ] 15.2.1* זיהוי דפוסי למידה
  - [ ] 15.2.2* המלצות אישיות
- [ ] 15.3* אינטגרציה עם כלים חיצוניים
  - [ ] 15.3.1* יצוא ל-LMS חיצוני
  - [ ] 15.3.2* אינטגרציה עם Google Classroom

### 16. שיפורים עתידיים
- [ ] 16.1* הוספת תמיכה בפלטפורמות וידאו נוספות
- [ ] 16.2* פיתוח אפליקציה ניידת
- [ ] 16.3* הוספת תכונות נגישות מתקדמות